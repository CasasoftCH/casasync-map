function InfoBox(t){t=t||{},google.maps.OverlayView.apply(this,arguments),this.content_=t.content||"",this.disableAutoPan_=t.disableAutoPan||!1,this.maxWidth_=t.maxWidth||0,this.pixelOffset_=t.pixelOffset||new google.maps.Size(0,0),this.position_=t.position||new google.maps.LatLng(0,0),this.zIndex_=t.zIndex||null,this.boxClass_=t.boxClass||"infoBox",this.boxStyle_=t.boxStyle||{},this.closeBoxMargin_=t.closeBoxMargin||"2px",this.closeBoxURL_=t.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",""===t.closeBoxURL&&(this.closeBoxURL_=""),this.infoBoxClearance_=t.infoBoxClearance||new google.maps.Size(1,1),"undefined"==typeof t.visible&&(t.visible="undefined"==typeof t.isHidden?!0:!t.isHidden),this.isHidden_=!t.visible,this.alignBottom_=t.alignBottom||!1,this.pane_=t.pane||"floatPane",this.enableEventPropagation_=t.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.moveListener_=null,this.contextListener_=null,this.eventListeners_=null,this.fixedWidthSet_=null}jQuery(function(){"use strict";function t(){var t=new google.maps.LatLng(46.8131873,8.2242101),e=new google.maps.Geocoder;e.geocode({address:"switzerland"},function(t,e){e==google.maps.GeocoderStatus.OK&&(a.setCenter(t[0].geometry.location),a.fitBounds(t[0].geometry.viewport))});var i="SATELLITE"==$("#casasync-map_map").data("map_type")?google.maps.MapTypeId.SATELLITE:google.maps.MapTypeId.ROADMAP,n={center:t,mapTypeId:i,mapTypeControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER},panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!1,streetViewControl:!1};a=new google.maps.Map(document.getElementById("casasync-map_map"),n),o(),google.maps.event.addListenerOnce(a,"tilesloaded",function(){r()})}function e(t){h.close(a);var e="";window.casasyncMapOptions&&window.casasyncMapOptions.marker_image&&(e=window.casasyncMapOptions.marker_image);var i=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),map:a,icon:e});l.push(i),google.maps.event.addListener(i,"click",function(e){return function(){var i=$("#casasync-map_map").data("readmore_text"),o=window.casasyncMapOptions.infobox_template?$(window.casasyncMapOptions.infobox_template)[0].outerHTML:!1,n={readMoreText:i},s={property:t,options:n};Mustache.parse(o);var r=Mustache.render(o,s);h.setContent(r),h.open(a,e)}}(i))}function i(t){for(var e=0;e<l.length;e++)l[e].setMap(t)}function o(){var t=!1;if(window.casasyncMapOptions&&window.casasyncMapOptions.plugin_url)var t=window.casasyncMapOptions.plugin_url+"assets/img/close.png";var e={pixelOffset:new google.maps.Size(-140,0),closeBoxMargin:"18px 5px 5px 5px",closeBoxURL:t,infoBoxClearance:new google.maps.Size(20,20)};h=new InfoBox(e)}function n(){i(null)}function s(){n(),l=[]}function r(){var t=$("#casasync_map_filter").find('li[data-current="1"]').attr("data-url"),i=$.ajax({url:t,type:"GET",dataType:"json",data:{casasync_map:!0},complete:function(){alert(this.url)}}).done(function(t){s(),$.each(t,function(t,i){e(i)})})}var $=jQuery,a,l=[],h=!1,p;google.maps.event.addDomListener(window,"load",t),$("#casasync_map_filter li").click(function(t){$('#casasync_map_filter li[data-current="1"]').attr("data-current",0),$(this).attr("data-current",1),r()})}),function(t,e){"object"==typeof exports&&exports?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Mustache={})}(this,function(t){function e(t){return"function"==typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return u.call(t,e)}function n(t){return!o(g,t)}function s(t){return String(t).replace(/[&<>"'\/]/g,function(t){return _[t]})}function r(e,o){function s(){if(u&&!g)for(;c.length;)delete d[c.pop()];else c=[];u=!1,g=!1}function r(t){if("string"==typeof t&&(t=t.split(y,2)),!f(t)||2!==t.length)throw new Error("Invalid tags: "+t);_=new RegExp(i(t[0])+"\\s*"),B=new RegExp("\\s*"+i(t[1])),b=new RegExp("\\s*"+i("}"+t[1]))}if(!e)return[];var p=[],d=[],c=[],u=!1,g=!1,_,B,b;r(o||t.tags);for(var L=new h(e),I,C,T,M,S,O;!L.eos();){if(I=L.pos,T=L.scanUntil(_))for(var P=0,k=T.length;k>P;++P)M=T.charAt(P),n(M)?c.push(d.length):g=!0,d.push(["text",M,I,I+1]),I+=1,"\n"===M&&s();if(!L.scan(_))break;if(u=!0,C=L.scan(w)||"name",L.scan(v),"="===C?(T=L.scanUntil(x),L.scan(x),L.scanUntil(B)):"{"===C?(T=L.scanUntil(b),L.scan(m),L.scanUntil(B),C="&"):T=L.scanUntil(B),!L.scan(B))throw new Error("Unclosed tag at "+L.pos);if(S=[C,T,I,L.pos],d.push(S),"#"===C||"^"===C)p.push(S);else if("/"===C){if(O=p.pop(),!O)throw new Error('Unopened section "'+T+'" at '+I);if(O[1]!==T)throw new Error('Unclosed section "'+O[1]+'" at '+I)}else"name"===C||"{"===C||"&"===C?g=!0:"="===C&&r(T)}if(O=p.pop())throw new Error('Unclosed section "'+O[1]+'" at '+L.pos);return l(a(d))}function a(t){for(var e=[],i,o,n=0,s=t.length;s>n;++n)i=t[n],i&&("text"===i[0]&&o&&"text"===o[0]?(o[1]+=i[1],o[3]=i[3]):(e.push(i),o=i));return e}function l(t){for(var e=[],i=e,o=[],n,s,r=0,a=t.length;a>r;++r)switch(n=t[r],n[0]){case"#":case"^":i.push(n),o.push(n),i=n[4]=[];break;case"/":s=o.pop(),s[5]=n[2],i=o.length>0?o[o.length-1][4]:e;break;default:i.push(n)}return e}function h(t){this.string=t,this.tail=t,this.pos=0}function p(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function d(){this.cache={}}var c=Object.prototype.toString,f=Array.isArray||function(t){return"[object Array]"===c.call(t)},u=RegExp.prototype.test,g=/\S/,_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},v=/\s*/,y=/\s+/,x=/\s*=/,m=/\s*\}/,w=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var i=e[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},h.prototype.scanUntil=function(t){var e=this.tail.search(t),i;switch(e){case-1:i=this.tail,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,e),this.tail=this.tail.substring(e)}return this.pos+=i.length,i},p.prototype.push=function(t){return new p(t,this)},p.prototype.lookup=function(t){var i=this.cache,o;if(t in i)o=i[t];else{for(var n=this,s,r,a=!1;n;){if(t.indexOf(".")>0)for(o=n.view,s=t.split("."),r=0;null!=o&&r<s.length;)r===s.length-1&&null!=o&&(a="object"==typeof o&&o.hasOwnProperty(s[r])),o=o[s[r++]];else null!=n.view&&"object"==typeof n.view&&(o=n.view[t],a=n.view.hasOwnProperty(t));if(a)break;n=n.parent}i[t]=o}return e(o)&&(o=o.call(this.view)),o},d.prototype.clearCache=function(){this.cache={}},d.prototype.parse=function(t,e){var i=this.cache,o=i[t];return null==o&&(o=i[t]=r(t,e)),o},d.prototype.render=function(t,e,i){var o=this.parse(t),n=e instanceof p?e:new p(e);return this.renderTokens(o,n,i,t)},d.prototype.renderTokens=function(t,e,i,o){for(var n="",s,r,a,l=0,h=t.length;h>l;++l)a=void 0,s=t[l],r=s[0],"#"===r?a=this._renderSection(s,e,i,o):"^"===r?a=this._renderInverted(s,e,i,o):">"===r?a=this._renderPartial(s,e,i,o):"&"===r?a=this._unescapedValue(s,e):"name"===r?a=this._escapedValue(s,e):"text"===r&&(a=this._rawValue(s)),void 0!==a&&(n+=a);return n},d.prototype._renderSection=function(t,i,o,n){function s(t){return r.render(t,i,o)}var r=this,a="",l=i.lookup(t[1]);if(l){if(f(l))for(var h=0,p=l.length;p>h;++h)a+=this.renderTokens(t[4],i.push(l[h]),o,n);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)a+=this.renderTokens(t[4],i.push(l),o,n);else if(e(l)){if("string"!=typeof n)throw new Error("Cannot use higher-order sections without the original template");l=l.call(i.view,n.slice(t[3],t[5]),s),null!=l&&(a+=l)}else a+=this.renderTokens(t[4],i,o,n);return a}},d.prototype._renderInverted=function(t,e,i,o){var n=e.lookup(t[1]);return!n||f(n)&&0===n.length?this.renderTokens(t[4],e,i,o):void 0},d.prototype._renderPartial=function(t,i,o){if(o){var n=e(o)?o(t[1]):o[t[1]];return null!=n?this.renderTokens(this.parse(n),i,o,n):void 0}},d.prototype._unescapedValue=function(t,e){var i=e.lookup(t[1]);return null!=i?i:void 0},d.prototype._escapedValue=function(e,i){var o=i.lookup(e[1]);return null!=o?t.escape(o):void 0},d.prototype._rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.0.0",t.tags=["{{","}}"];var B=new d;t.clearCache=function(){return B.clearCache()},t.parse=function(t,e){return B.parse(t,e)},t.render=function(t,e,i){return B.render(t,e,i)},t.to_html=function(i,o,n,s){var r=t.render(i,o,n);return e(s)?void s(r):r},t.escape=s,t.Scanner=h,t.Context=p,t.Writer=d}),InfoBox.prototype=new google.maps.OverlayView,InfoBox.prototype.createInfoBoxDiv_=function(){var t,e,i,o=this,n=function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()},s=function(t){t.returnValue=!1,t.preventDefault&&t.preventDefault(),o.enableEventPropagation_||n(t)};if(!this.div_){if(this.div_=document.createElement("div"),this.setBoxStyle_(),"undefined"==typeof this.content_.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:0!==this.maxWidth_&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(i=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-i.left-i.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_),!this.enableEventPropagation_){for(this.eventListeners_=[],e=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],t=0;t<e.length;t++)this.eventListeners_.push(google.maps.event.addDomListener(this.div_,e[t],n));this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(t){this.style.cursor="default"}))}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",s),google.maps.event.trigger(this,"domready")}},InfoBox.prototype.getCloseBoxImg_=function(){var t="";return""!==this.closeBoxURL_&&(t="<img",t+=" src='"+this.closeBoxURL_+"'",t+=" align=right",t+=" style='",t+=" position: relative;",t+=" cursor: pointer;",t+=" margin: "+this.closeBoxMargin_+";",t+="'>"),t},InfoBox.prototype.addClickHandler_=function(){var t;""!==this.closeBoxURL_?(t=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(t,"click",this.getCloseClickHandler_())):this.closeListener_=null},InfoBox.prototype.getCloseClickHandler_=function(){var t=this;return function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),google.maps.event.trigger(t,"closeclick"),t.close()}},InfoBox.prototype.panBox_=function(t){var e,i,o=0,n=0;if(!t&&(e=this.getMap(),e instanceof google.maps.Map)){e.getBounds().contains(this.position_)||e.setCenter(this.position_),i=e.getBounds();var s=e.getDiv(),r=s.offsetWidth,a=s.offsetHeight,l=this.pixelOffset_.width,h=this.pixelOffset_.height,p=this.div_.offsetWidth,d=this.div_.offsetHeight,c=this.infoBoxClearance_.width,f=this.infoBoxClearance_.height,u=this.getProjection().fromLatLngToContainerPixel(this.position_);if(u.x<-l+c?o=u.x+l-c:u.x+p+l+c>r&&(o=u.x+p+l+c-r),this.alignBottom_?u.y<-h+f+d?n=u.y+h-f-d:u.y+h+f>a&&(n=u.y+h+f-a):u.y<-h+f?n=u.y+h-f:u.y+d+h+f>a&&(n=u.y+d+h+f-a),0!==o||0!==n){var g=e.getCenter();e.panBy(o,n)}}},InfoBox.prototype.setBoxStyle_=function(){var t,e;if(this.div_){this.div_.className=this.boxClass_,this.div_.style.cssText="",e=this.boxStyle_;for(t in e)e.hasOwnProperty(t)&&(this.div_.style[t]=e[t]);this.div_.style.WebkitTransform="translateZ(0)","undefined"!=typeof this.div_.style.opacity&&""!==this.div_.style.opacity&&(this.div_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+100*this.div_.style.opacity+')"',this.div_.style.filter="alpha(opacity="+100*this.div_.style.opacity+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",null!==this.zIndex_&&(this.div_.style.zIndex=this.zIndex_)}},InfoBox.prototype.getBoxWidths_=function(){var t,e={top:0,bottom:0,left:0,right:0},i=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(t=i.ownerDocument.defaultView.getComputedStyle(i,""),t&&(e.top=parseInt(t.borderTopWidth,10)||0,e.bottom=parseInt(t.borderBottomWidth,10)||0,e.left=parseInt(t.borderLeftWidth,10)||0,e.right=parseInt(t.borderRightWidth,10)||0)):document.documentElement.currentStyle&&i.currentStyle&&(e.top=parseInt(i.currentStyle.borderTopWidth,10)||0,e.bottom=parseInt(i.currentStyle.borderBottomWidth,10)||0,e.left=parseInt(i.currentStyle.borderLeftWidth,10)||0,e.right=parseInt(i.currentStyle.borderRightWidth,10)||0),e},InfoBox.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var t=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=t.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(t.y+this.pixelOffset_.height)+"px":this.div_.style.top=t.y+this.pixelOffset_.height+"px",this.div_.style.visibility=this.isHidden_?"hidden":"visible"},InfoBox.prototype.setOptions=function(t){"undefined"!=typeof t.boxClass&&(this.boxClass_=t.boxClass,this.setBoxStyle_()),"undefined"!=typeof t.boxStyle&&(this.boxStyle_=t.boxStyle,this.setBoxStyle_()),"undefined"!=typeof t.content&&this.setContent(t.content),"undefined"!=typeof t.disableAutoPan&&(this.disableAutoPan_=t.disableAutoPan),"undefined"!=typeof t.maxWidth&&(this.maxWidth_=t.maxWidth),"undefined"!=typeof t.pixelOffset&&(this.pixelOffset_=t.pixelOffset),"undefined"!=typeof t.alignBottom&&(this.alignBottom_=t.alignBottom),"undefined"!=typeof t.position&&this.setPosition(t.position),"undefined"!=typeof t.zIndex&&this.setZIndex(t.zIndex),"undefined"!=typeof t.closeBoxMargin&&(this.closeBoxMargin_=t.closeBoxMargin),"undefined"!=typeof t.closeBoxURL&&(this.closeBoxURL_=t.closeBoxURL),"undefined"!=typeof t.infoBoxClearance&&(this.infoBoxClearance_=t.infoBoxClearance),"undefined"!=typeof t.isHidden&&(this.isHidden_=t.isHidden),"undefined"!=typeof t.visible&&(this.isHidden_=!t.visible),"undefined"!=typeof t.enableEventPropagation&&(this.enableEventPropagation_=t.enableEventPropagation),this.div_&&this.draw()},InfoBox.prototype.setContent=function(t){this.content_=t,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),"undefined"==typeof t.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+t:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(t)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px","undefined"==typeof t.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+t:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(t))),this.addClickHandler_()),google.maps.event.trigger(this,"content_changed")},InfoBox.prototype.setPosition=function(t){this.position_=t,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed")},InfoBox.prototype.setZIndex=function(t){this.zIndex_=t,this.div_&&(this.div_.style.zIndex=t),google.maps.event.trigger(this,"zindex_changed")},InfoBox.prototype.setVisible=function(t){this.isHidden_=!t,this.div_&&(this.div_.style.visibility=this.isHidden_?"hidden":"visible")},InfoBox.prototype.getContent=function(){return this.content_},InfoBox.prototype.getPosition=function(){return this.position_},InfoBox.prototype.getZIndex=function(){return this.zIndex_},InfoBox.prototype.getVisible=function(){var t;return t="undefined"==typeof this.getMap()||null===this.getMap()?!1:!this.isHidden_},InfoBox.prototype.show=function(){this.isHidden_=!1,this.div_&&(this.div_.style.visibility="visible")},InfoBox.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden")},InfoBox.prototype.open=function(t,e){var i=this;e&&(this.position_=e.getPosition(),this.moveListener_=google.maps.event.addListener(e,"position_changed",function(){i.setPosition(this.getPosition())})),this.setMap(t),this.div_&&this.panBox_()},InfoBox.prototype.close=function(){var t;if(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.eventListeners_){for(t=0;t<this.eventListeners_.length;t++)google.maps.event.removeListener(this.eventListeners_[t]);this.eventListeners_=null}this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null)};